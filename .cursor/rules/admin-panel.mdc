---
description: Keep admin panel accessible; prevent 404s and broken admin login
alwaysApply: false
globs: src/app/admin/**/*
---

# Admin Panel Safeguards

## Design (do not change)

- **Single entry point**: `/admin` is the only URL users need. When not authorized, `/admin` shows an **inline login form** (email + password) on the same page. Do not remove this inline form or make admin access depend only on `/admin/login`.
- **/admin/login**: Exists only as a redirect to `/admin`. This avoids 404s if the login route is ever missing in a deployment; users can always use `/admin`.

## When editing admin code

- Do **not** remove the inline login form from `src/app/admin/page.tsx` (the block that renders when `!authorized`).
- Do **not** remove `src/app/admin/page.tsx` or `src/app/admin/login/page.tsx`.
- Do **not** add middleware or rewrites that exclude `/admin` or `/admin/login` (or break the obscure-path logic in `src/proxy.ts`).
- After any change under `src/app/admin/`, ensure the project still builds and deploy so production has the latest admin routes.

## Obscure admin path (optional)

When **ADMIN_BASE_PATH** is set in env, proxy rewrites only that path to the admin panel and returns 404 for direct `/admin`. Do not remove this logic from `src/proxy.ts`; use `getAdminBase()` from `@/lib/admin` for client redirects so the obscure path works.

## Why this prevents 404s

Previously, admin login lived only at `/admin/login`. If that route was missing in a deployment (e.g. old deploy, build issue), users got 404. By keeping login **on** `/admin`, the panel works even when `/admin/login` is missing. Redirecting `/admin/login` â†’ `/admin` keeps old links working.
